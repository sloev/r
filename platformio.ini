[env:heltec_wifi_lora_32_V3]
platform = espressif32
board = heltec_wifi_lora_32_V3
framework = arduino
monitor_speed = 115200
upload_speed = 921600

; --- Build Strategy ---
; Merges bootloader + partitions + app into a single binary for easy distribution
extra_scripts = merge_bin.py

; --- Compiler Discipline ---
build_flags = 
    -D BOARD_HELTEC_V3
    -D RNS_LOGGING_ENABLED
    -D CORE_DEBUG_LEVEL=3
    ; Strict warnings. We don't want sloppy code hiding in the mesh.
    -Wall
    -Wextra
    ; Optimization: balance size and speed
    -Os 
    ; Packet Buffer Sizing (Matches RNS MTU)
    -D RNS_MAX_PACKET_SIZE=512

; --- Dependency Management ---
; "deep+" is CRITICAL. It forces the linker to index our flattened 
; vendored library in lib/Monocypher correctly.
lib_ldf_mode = deep+

lib_deps =
    jgromes/RadioLib @ ^6.3.0
    bblanchon/ArduinoJson @ ^6.21.0
    h2zero/NimBLE-Arduino @ ^1.4.0